vscode 1
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 33167
ImageBase : 4194304
MajorOperatingSystemVersion : 5
MajorSubsystemVersion : 5
Subsystem : 2
DllCharacteristics : 32768
SectionsNb : 8
SectionsMeanEntropy : 2.89865879448
SectionsMinEntropy : 0.0
SectionsMaxEntropy : 6.39164664964
ResourcesMaxEntropy : 7.66543352117
ResourcesMinSize : 16
VersionInformationSize : 0

GNB : 70.488953 %
GNB : malicious
False positive rate : 0.000000 %
False negative rate : 99.987729 %
0
DecisionTree : 99.210431 %
DecisionTree : legitimate
False positive rate : 0.570372 %
False negative rate : 1.313045 %
1
RandomForest : 99.406012 %
RandomForest : legitimate
False positive rate : 0.472740 %
False negative rate : 0.883544 %
1
AdaBoost : 98.667150 %
AdaBoost : malicious
False positive rate : 0.858127 %
False negative rate : 2.466560 %
0
GradientBoosting : 98.837378 %
GradientBoosting : malicious
False positive rate : 0.729664 %
False negative rate : 2.196589 %
0




Test2 1
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 290
ImageBase : 4194304
MajorSubsystemVersion : 6
Subsystem : 3
DllCharacteristics : 33088
SectionsMeanEntropy : 5.06591696662
SectionsMinEntropy : 4.12797693051
SectionsMaxEntropy : 6.43864790277
ImportsNbDLL : 12
ResourcesMaxEntropy : 7.64109457039
VersionInformationSize : 0

GNB : 70.148497 %
GNB : malicious
False positive rate : 0.000000 %
False negative rate : 99.987868 %
0
DecisionTree : 99.232162 %
DecisionTree : legitimate
False positive rate : 0.635101 %
False negative rate : 1.079704 %
1
RandomForest : 99.485694 %
RandomForest : legitimate
False positive rate : 0.433727 %
False negative rate : 0.703627 %
1
AdaBoost : 98.688881 %
AdaBoost : legitimate
False positive rate : 0.846801 %
False negative rate : 2.402038 %
1
GradientBoosting : 98.971387 %
GradientBoosting : legitimate
False positive rate : 0.728043 %
False negative rate : 1.734805 %
1




Sublime 1
Machine : 332
Characteristics : 33167
ImageBase : 4194304
MajorSubsystemVersion : 5
Subsystem : 2
DllCharacteristics : 32768
ResourcesMaxEntropy : 5.17905859207
VersionInformationSize : 0

GNB : 69.960159 %
GNB : malicious
False positive rate : 0.000000 %
False negative rate : 99.987945 %
0
DecisionTree : 98.902572 %
DecisionTree : malicious
False positive rate : 0.678229 %
False negative rate : 2.073538 %
0
RandomForest : 99.188700 %
RandomForest : legitimate
False positive rate : 0.704116 %
False negative rate : 1.060880 %
1
AdaBoost : 98.286853 %
AdaBoost : malicious
False positive rate : 0.947450 %
False negative rate : 3.496082 %
0
GradientBoosting : 98.656284 %
GradientBoosting : malicious
False positive rate : 0.952627 %
False negative rate : 2.254370 %
0





sublime wrong 0
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 33167
ImageBase : 4194304
Subsystem : 2
DllCharacteristics : 32768
SizeOfStackReserve : 1048576
SectionsMaxEntropy : 6.39148264826
ResourcesMinEntropy : 2.56031160924
ResourcesMaxEntropy : 5.17905859207
VersionInformationSize : 0

GNB : 69.981891 %
GNB : malicious
False positive rate : 0.000000 %
False negative rate : 99.975875 %
0
DecisionTree : 99.083665 %
DecisionTree : malicious
False positive rate : 0.729814 %
False negative rate : 1.351025 %
0
RandomForest : 99.355306 %
RandomForest : malicious
False positive rate : 0.517598 %
False negative rate : 0.940893 %
0
AdaBoost : 98.688881 %
AdaBoost : malicious
False positive rate : 0.843685 %
False negative rate : 2.400483 %
0
GradientBoosting : 98.812025 %
GradientBoosting : malicious
False positive rate : 0.786749 %
False negative rate : 2.123040 %
0




Test1 0
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 258
ImageBase : 4194304
MajorSubsystemVersion : 5
Subsystem : 2
DllCharacteristics : 34112
SizeOfStackReserve : 1048576
SectionsMaxEntropy : 6.49970859063
ResourcesMaxEntropy : 7.98841194861
VersionInformationSize : 0

GNB : 70.289750 %
GNB : malicious
False positive rate : 0.000000 %
False negative rate : 100.000000 %
0
DecisionTree : 99.152481 %
DecisionTree : malicious
False positive rate : 0.556500 %
False negative rate : 1.536023 %
0
RandomForest : 99.351684 %
RandomForest : malicious
False positive rate : 0.541042 %
False negative rate : 0.902109 %
0
AdaBoost : 98.692503 %
AdaBoost : malicious
False positive rate : 0.783223 %
False negative rate : 2.547848 %
0
GradientBoosting : 98.862731 %
GradientBoosting : malicious
False positive rate : 0.752306 %
False negative rate : 2.048031 %







from featureExtraction import extract_infos
import pefile
import os
import array
import math
import pickle
from sklearn.externals import joblib
import sys
import argparse
import os, sys, shutil, time
import re
import pandas as pd
from choose_classifier import getResult
from flask import Flask, request, jsonify, render_template,abort,redirect,url_for
from werkzeug import secure_filename
from sklearn.externals import joblib
from sklearn.ensemble import RandomForestClassifier
import numpy as np
import sklearn.ensemble as ske 
from sklearn import  tree, linear_model
from sklearn.feature_selection import SelectFromModel
from sklearn.externals import joblib
from sklearn.naive_bayes import GaussianNB
from algorithm import algorithms
from sklearn.metrics import confusion_matrix
from sklearn.model_selection import train_test_split
def cutit(s,n):
   return s[n:]

app = Flask(__name__)




@app.route('/')
def home():
    return render_template('index.html')


	
@app.route('/uploader', methods = ['GET', 'POST'])
def upload_file():
   if request.method == 'POST':
    data = pd.read_csv('./data/data1.csv', sep='|')
    X = data.drop(['Name', 'md5', 'legitimate'], axis=1).values #now droping some coloumns as axis 1(mean coloumn) and will show the values in the rows
    y = data['legitimate'].values #values of legitimate data

    print('Researching important feature based on %i total features\n' % X.shape[1])# shape() is use in pandas to give number of row/column
    newX = []
    newY = []
    for i in X:
        a1 = []
        flag = 1
        for j in i:
            try:
                k = float(j)
                a1.append(k)
            except:
                flag = 0
                break
        if flag == 1:
            newX.append(a1)
    for i in y:
        try:
            k = float(i)
            newY.append(k)
        except:
            print('')   
    fsel = ske.ExtraTreesClassifier().fit(X, y)
    # X = newX
    # y = newY
    model = SelectFromModel(fsel, prefit=True)
    X_new = model.transform(X)#now features are only 9 :)
    nb_features = X_new.shape[1]#will save value 13 as shape is (138047, 13) :}



    X_train, X_test, y_train, y_test = train_test_split(X_new, y ,test_size=0.2)#now converting in training and testing data in 20% range 
    features = []

    print('%i features identified as important:' % nb_features) #as mentioned above


    #important features stored
    indices = np.argsort(fsel.feature_importances_)[::-1][:nb_features]
    for f in range(nb_features):
        print("%d. feature %s (%f)" % (f + 1, data.columns[2+indices[f]], fsel.feature_importances_[indices[f]]))

    # mean adding to the empty 'features' array the 'important features'
    for f in sorted(np.argsort(fsel.feature_importances_)[::-1][:nb_features]):#[::-1] mean start with last towards first 
        features.append(data.columns[2+f])

    print("Upload.....#######################################")
    f = request.files['file']
    f.save(secure_filename(f.filename))
    ##########################################
    # Load classifier
    # maxclf = joblib.load(os.path.join(os.path.dirname(os.path.realpath(__file__)),'classifier/classifier.pkl'))
    # features =pickle.loads(open(os.path.join(os.path.dirname(os.path.realpath(__file__))
                                    #    ,'classifier/features.pkl'),'r').read())
     ##########################################
    tweet =f.filename
    print("Tweats.....#######################################  " + tweet + "..#######################################")
     #########################################
    order,data = extract_infos(tweet)
    pe_features = map(lambda x: data[x], features)
    print('Features.....#######################################  ')
    j = 0
    for i in features:
        print(i + ' : ' + str(pe_features[j]))
        j = j+1
    print('..#######################################')
    print("Upload.....#######################################")
    
    malicious = 0
    legitimate = 0
    res = 1
    # clf = maxclf
    max_res = 0
    max_score = 0
    for algo in algorithms:
        clf = algorithms[algo]
        clf.fit(X_train, y_train)
        score = clf.score(X_test, y_test)
        print("%s : %f %%" % (algo, score*100))
    
        res1 = clf.predict(X_test)
        res = clf.predict([pe_features])[0]
        res = int(res)
        if score > max_score:
            max_score = score
            max_res = res
        print(algo + ' : ' + ['malicious', 'legitimate'][res])
        mt = confusion_matrix(y_test, res1)
        #A confusion matrix, also known as an error matrix,[4] is a specific table layout that allows visualization of the performance of an algorithm, typically a supervised learning.
        print("False positive rate : %f %%" % ((mt[0][1] / float(sum(mt[0])))*100))
        print('False negative rate : %f %%' % ( (mt[1][0] / float(sum(mt[1]))*100)))
        print(res)
        if res == 1:
            legitimate = legitimate+1
        else:
            malicious = malicious+1
    if malicious > legitimate:
        res = 0
        #########################################
     #print('The file %s is %s' % (os.path.basename(sys.argv[1]),['malicious', 'legitimate'][res]))
    print('Majority result: ' + ['malicious', 'legitimate'][res])
    print('Winner Classifier result: ' + ['malicious', 'legitimate'][max_res])
    return render_template('result.html', prediction = ['malicious', 'legitimate'][max_res])



if __name__ == '__main__':
  app.run(debug = True)



vs in  data1.csv  1
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 33167
MajorLinkerVersion : 2
MinorLinkerVersion : 25
ImageBase : 4194304
SectionAlignment : 4096
FileAlignment : 512
MajorOperatingSystemVersion : 5
MinorOperatingSystemVersion : 0
MajorImageVersion : 6
MajorSubsystemVersion : 5
MinorSubsystemVersion : 0
CheckSum : 43946166
Subsystem : 2
DllCharacteristics : 32768
SizeOfStackReserve : 1048576
SectionsNb : 8
SectionsMeanEntropy : 2.89865879448
SectionsMinEntropy : 0.0
SectionsMaxEntropy : 6.39164664964
ImportsNb : 120
ResourcesMeanEntropy : 3.32111232535
ResourcesMinEntropy : 1.70690508818
ResourcesMaxEntropy : 7.66543352117
ResourcesMinSize : 16
LoadConfigurationSize : 0
VersionInformationSize : 0


vscode not in data1.csv  0
Machine : 332
SizeOfOptionalHeader : 224
Characteristics : 290
MajorLinkerVersion : 10
ImageBase : 4194304
SectionAlignment : 4096
FileAlignment : 512
MajorOperatingSystemVersion : 5
MinorOperatingSystemVersion : 1
MajorSubsystemVersion : 5
SizeOfHeaders : 1024
Subsystem : 2
DllCharacteristics : 33088
SizeOfStackReserve : 1048576
SectionsNb : 8
SectionsMeanEntropy : 3.4582260459
SectionsMinEntropy : 0.0611628522412
SectionsMaxEntropy : 6.5515069211
ImportsNbDLL : 3
ImportsNb : 124
ResourcesNb : 16
ResourcesMinEntropy : 2.08644308272
ResourcesMaxEntropy : 7.98599722517
LoadConfigurationSize : 72
VersionInformationSize : 0
